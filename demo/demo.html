<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>demo</title>
  <style>

    textarea {

    }

  </style>

  <link rel="stylesheet" href="../node_modules/popover/popover.css">
  <link rel="stylesheet" href="../node_modules/popover/popover-theme.css">
</head>
<body>
  <textarea name="" id="a" cols="30" rows="10">
<button>asdas</button>
  '1462246368222316524 159 1
'1462246473675033830  159 1
'1462246913263491923  159 1
</textarea>
  <div id="showPaste"></div>
  <table contenteditable='true'>
    <thead>
      <tr>
        <th>1</th>
        <th>2</th>
        <th>3</th>
        <th>4</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td  data-row=1 class="tdInput"><input type="text"></td>
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td><input type="text"></td>
      </tr>
      <tr>
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td><input type="text"></td>
      </tr>
      <tr>
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td><input type="text"></td>
      </tr>
      <tr>
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td><input type="text"></td>
      </tr>
    </tbody>
  </table>

  <div id='div' contenteditable='true' onpaste='handlepaste(this, event)'>Paste</div>
  <!-- <script src="../node_modules/jquery/dist/jquery.min.js"></script> -->
  <script src="../node_modules/popover/popover.built.js"></script>
  <!-- <script src="../src/jquery.cliptable.js"></script> -->
  <script src="../src/cliptable.js"></script>

  <script>

    window.onload = function () {
      var table = document.querySelector('table');

      cliptable(table, {
        trOverflowCallback: function (data, options) {

          var tr = document.createElement("tr");

          for (var i = 0; i < 4; i++) {
            var td = document.createElement("td");
            var input = document.createElement("input");
            td.appendChild(input);
            tr.appendChild(td);

          }

          data.tBody.appendChild(tr);

          return true;
        },

        tdOverflowCallback: function (data, options) {


          var td = document.createElement("td");
          var input = document.createElement("input");
          td.appendChild(input);

          data.tr.appendChild(td);

          return true;
        }
      });
    };


    function handlepaste (elem, e) {
    var savedcontent = elem.innerHTML;
    if (e && e.clipboardData && e.clipboardData.getData) {// Webkit - get data from clipboard, put into editdiv, cleanup, then cancel event
        if (/text\/html/.test(e.clipboardData.types)) {
            elem.innerHTML = e.clipboardData.getData('text/html');
        }
        else if (/text\/plain/.test(e.clipboardData.types)) {
            elem.innerHTML = e.clipboardData.getData('text/plain');
        }
        else {
            elem.innerHTML = "";
        }
        waitforpastedata(elem, savedcontent);
        if (e.preventDefault) {
                e.stopPropagation();
                e.preventDefault();
        }
        return false;
    }
    else {// Everything else - empty editdiv and allow browser to paste content into it, then cleanup
        elem.innerHTML = "";
        waitforpastedata(elem, savedcontent);
        return true;
    }
}

function waitforpastedata (elem, savedcontent) {
    if (elem.childNodes && elem.childNodes.length > 0) {
        processpaste(elem, savedcontent);
    }
    else {
        that = {
            e: elem,
            s: savedcontent
        }
        that.callself = function () {
            waitforpastedata(that.e, that.s)
        }
        setTimeout(that.callself,20);
    }
}

function processpaste (elem, savedcontent) {
    pasteddata = elem.innerHTML;
    //^^Alternatively loop through dom (elem.childNodes or elem.getElementsByTagName) here

    elem.innerHTML = savedcontent;

    // console.log(pasteddata);
    // Do whatever with gathered data;
    alert(pasteddata);
}
  </script>
</body>
</html>
